{"ast":null,"code":"import _classCallCheck from \"D:\\\\Project\\\\React\\\\riwasu-react-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"D:\\\\Project\\\\React\\\\riwasu-react-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\Project\\\\React\\\\riwasu-react-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _createClass from \"D:\\\\Project\\\\React\\\\riwasu-react-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _inherits from \"D:\\\\Project\\\\React\\\\riwasu-react-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n/**\n * @license Copyright (c) 2003-2022, CKSource Holding sp. z o.o. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\n/**\n * @module image/imageupload/imageuploadprogress\n */\n\n/* globals setTimeout */\nimport { Plugin } from 'ckeditor5/src/core';\nimport { FileRepository } from 'ckeditor5/src/upload';\nimport '../../theme/imageuploadprogress.css';\nimport '../../theme/imageuploadicon.css';\nimport '../../theme/imageuploadloader.css';\n/**\n * The image upload progress plugin.\n * It shows a placeholder when the image is read from the disk and a progress bar while the image is uploading.\n *\n * @extends module:core/plugin~Plugin\n */\n\nvar ImageUploadProgress = /*#__PURE__*/function (_Plugin) {\n  _inherits(ImageUploadProgress, _Plugin);\n\n  _createClass(ImageUploadProgress, null, [{\n    key: \"pluginName\",\n\n    /**\n     * @inheritDoc\n     */\n    get: function get() {\n      return 'ImageUploadProgress';\n    }\n    /**\n     * @inheritDoc\n     */\n\n  }]);\n\n  function ImageUploadProgress(editor) {\n    var _this;\n\n    _classCallCheck(this, ImageUploadProgress);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ImageUploadProgress).call(this, editor));\n    /**\n     * The image placeholder that is displayed before real image data can be accessed.\n     *\n     * For the record, this image is a 1x1 px GIF with an aspect ratio set by CSS.\n     *\n     * @protected\n     * @member {String} #placeholder\n     */\n\n    _this.placeholder = 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==';\n    return _this;\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  _createClass(ImageUploadProgress, [{\n    key: \"init\",\n    value: function init() {\n      var _this2 = this;\n\n      var editor = this.editor; // Upload status change - update image's view according to that status.\n\n      if (editor.plugins.has('ImageBlockEditing')) {\n        editor.editing.downcastDispatcher.on('attribute:uploadStatus:imageBlock', function () {\n          return _this2.uploadStatusChange.apply(_this2, arguments);\n        });\n      }\n\n      if (editor.plugins.has('ImageInlineEditing')) {\n        editor.editing.downcastDispatcher.on('attribute:uploadStatus:imageInline', function () {\n          return _this2.uploadStatusChange.apply(_this2, arguments);\n        });\n      }\n    }\n    /**\n     * This method is called each time the image `uploadStatus` attribute is changed.\n     *\n     * @param {module:utils/eventinfo~EventInfo} evt An object containing information about the fired event.\n     * @param {Object} data Additional information about the change.\n     * @param {module:engine/conversion/downcastdispatcher~DowncastConversionApi} conversionApi\n     */\n\n  }, {\n    key: \"uploadStatusChange\",\n    value: function uploadStatusChange(evt, data, conversionApi) {\n      var editor = this.editor;\n      var modelImage = data.item;\n      var uploadId = modelImage.getAttribute('uploadId');\n\n      if (!conversionApi.consumable.consume(data.item, evt.name)) {\n        return;\n      }\n\n      var imageUtils = editor.plugins.get('ImageUtils');\n      var fileRepository = editor.plugins.get(FileRepository);\n      var status = uploadId ? data.attributeNewValue : null;\n      var placeholder = this.placeholder;\n      var viewFigure = editor.editing.mapper.toViewElement(modelImage);\n      var viewWriter = conversionApi.writer;\n\n      if (status == 'reading') {\n        // Start \"appearing\" effect and show placeholder with infinite progress bar on the top\n        // while image is read from disk.\n        _startAppearEffect(viewFigure, viewWriter);\n\n        _showPlaceholder(imageUtils, placeholder, viewFigure, viewWriter);\n\n        return;\n      } // Show progress bar on the top of the image when image is uploading.\n\n\n      if (status == 'uploading') {\n        var loader = fileRepository.loaders.get(uploadId); // Start appear effect if needed - see https://github.com/ckeditor/ckeditor5-image/issues/191.\n\n        _startAppearEffect(viewFigure, viewWriter);\n\n        if (!loader) {\n          // There is no loader associated with uploadId - this means that image came from external changes.\n          // In such cases we still want to show the placeholder until image is fully uploaded.\n          // Show placeholder if needed - see https://github.com/ckeditor/ckeditor5-image/issues/191.\n          _showPlaceholder(imageUtils, placeholder, viewFigure, viewWriter);\n        } else {\n          // Hide placeholder and initialize progress bar showing upload progress.\n          _hidePlaceholder(viewFigure, viewWriter);\n\n          _showProgressBar(viewFigure, viewWriter, loader, editor.editing.view);\n\n          _displayLocalImage(imageUtils, viewFigure, viewWriter, loader);\n        }\n\n        return;\n      }\n\n      if (status == 'complete' && fileRepository.loaders.get(uploadId)) {\n        _showCompleteIcon(viewFigure, viewWriter, editor.editing.view);\n      } // Clean up.\n\n\n      _hideProgressBar(viewFigure, viewWriter);\n\n      _hidePlaceholder(viewFigure, viewWriter);\n\n      _stopAppearEffect(viewFigure, viewWriter);\n    }\n  }]);\n\n  return ImageUploadProgress;\n}(Plugin); // Adds ck-appear class to the image figure if one is not already applied.\n//\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n\n\nexport { ImageUploadProgress as default };\n\nfunction _startAppearEffect(viewFigure, writer) {\n  if (!viewFigure.hasClass('ck-appear')) {\n    writer.addClass('ck-appear', viewFigure);\n  }\n} // Removes ck-appear class to the image figure if one is not already removed.\n//\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n\n\nfunction _stopAppearEffect(viewFigure, writer) {\n  writer.removeClass('ck-appear', viewFigure);\n} // Shows placeholder together with infinite progress bar on given image figure.\n//\n// @param {module:image/imageutils~ImageUtils} imageUtils\n// @param {String} Data-uri with a svg placeholder.\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n\n\nfunction _showPlaceholder(imageUtils, placeholder, viewFigure, writer) {\n  if (!viewFigure.hasClass('ck-image-upload-placeholder')) {\n    writer.addClass('ck-image-upload-placeholder', viewFigure);\n  }\n\n  var viewImg = imageUtils.findViewImgElement(viewFigure);\n\n  if (viewImg.getAttribute('src') !== placeholder) {\n    writer.setAttribute('src', placeholder, viewImg);\n  }\n\n  if (!_getUIElement(viewFigure, 'placeholder')) {\n    writer.insert(writer.createPositionAfter(viewImg), _createPlaceholder(writer));\n  }\n} // Removes placeholder together with infinite progress bar on given image figure.\n//\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n\n\nfunction _hidePlaceholder(viewFigure, writer) {\n  if (viewFigure.hasClass('ck-image-upload-placeholder')) {\n    writer.removeClass('ck-image-upload-placeholder', viewFigure);\n  }\n\n  _removeUIElement(viewFigure, writer, 'placeholder');\n} // Shows progress bar displaying upload progress.\n// Attaches it to the file loader to update when upload percentace is changed.\n//\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n// @param {module:upload/filerepository~FileLoader} loader\n// @param {module:engine/view/view~View} view\n\n\nfunction _showProgressBar(viewFigure, writer, loader, view) {\n  var progressBar = _createProgressBar(writer);\n\n  writer.insert(writer.createPositionAt(viewFigure, 'end'), progressBar); // Update progress bar width when uploadedPercent is changed.\n\n  loader.on('change:uploadedPercent', function (evt, name, value) {\n    view.change(function (writer) {\n      writer.setStyle('width', value + '%', progressBar);\n    });\n  });\n} // Hides upload progress bar.\n//\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n\n\nfunction _hideProgressBar(viewFigure, writer) {\n  _removeUIElement(viewFigure, writer, 'progressBar');\n} // Shows complete icon and hides after a certain amount of time.\n//\n// @param {module:engine/view/containerelement~ContainerElement} viewFigure\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n// @param {module:engine/view/view~View} view\n\n\nfunction _showCompleteIcon(viewFigure, writer, view) {\n  var completeIcon = writer.createUIElement('div', {\n    class: 'ck-image-upload-complete-icon'\n  });\n  writer.insert(writer.createPositionAt(viewFigure, 'end'), completeIcon);\n  setTimeout(function () {\n    view.change(function (writer) {\n      return writer.remove(writer.createRangeOn(completeIcon));\n    });\n  }, 3000);\n} // Create progress bar element using {@link module:engine/view/uielement~UIElement}.\n//\n// @private\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n// @returns {module:engine/view/uielement~UIElement}\n\n\nfunction _createProgressBar(writer) {\n  var progressBar = writer.createUIElement('div', {\n    class: 'ck-progress-bar'\n  });\n  writer.setCustomProperty('progressBar', true, progressBar);\n  return progressBar;\n} // Create placeholder element using {@link module:engine/view/uielement~UIElement}.\n//\n// @private\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n// @returns {module:engine/view/uielement~UIElement}\n\n\nfunction _createPlaceholder(writer) {\n  var placeholder = writer.createUIElement('div', {\n    class: 'ck-upload-placeholder-loader'\n  });\n  writer.setCustomProperty('placeholder', true, placeholder);\n  return placeholder;\n} // Returns {@link module:engine/view/uielement~UIElement} of given unique property from image figure element.\n// Returns `undefined` if element is not found.\n//\n// @private\n// @param {module:engine/view/element~Element} imageFigure\n// @param {String} uniqueProperty\n// @returns {module:engine/view/uielement~UIElement|undefined}\n\n\nfunction _getUIElement(imageFigure, uniqueProperty) {\n  var _iterator = _createForOfIteratorHelper(imageFigure.getChildren()),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var child = _step.value;\n\n      if (child.getCustomProperty(uniqueProperty)) {\n        return child;\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n} // Removes {@link module:engine/view/uielement~UIElement} of given unique property from image figure element.\n//\n// @private\n// @param {module:engine/view/element~Element} imageFigure\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n// @param {String} uniqueProperty\n\n\nfunction _removeUIElement(viewFigure, writer, uniqueProperty) {\n  var element = _getUIElement(viewFigure, uniqueProperty);\n\n  if (element) {\n    writer.remove(writer.createRangeOn(element));\n  }\n} // Displays local data from file loader.\n//\n// @param {module:image/imageutils~ImageUtils} imageUtils\n// @param {module:engine/view/element~Element} imageFigure\n// @param {module:engine/view/downcastwriter~DowncastWriter} writer\n// @param {module:upload/filerepository~FileLoader} loader\n\n\nfunction _displayLocalImage(imageUtils, viewFigure, writer, loader) {\n  if (loader.data) {\n    var viewImg = imageUtils.findViewImgElement(viewFigure);\n    writer.setAttribute('src', loader.data, viewImg);\n  }\n}","map":null,"metadata":{},"sourceType":"module"}